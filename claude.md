# 開發指南

## 核心理念

### 基本信念

- **漸進式改進優於大爆炸式改動** - 能編譯並通過測試的小幅度變更
- **從現有程式碼中學習** - 實作前先研究與規劃
- **務實勝於教條** - 因應專案實際情況調整
- **清晰意圖勝於聰明程式碼** - 選擇無趣且顯而易見的做法

### 簡單意味著

- 每個函式/類別只負責單一職責
- 避免過早抽象化
- 不玩花招 - 選擇無趣的解決方案
- 如果需要解釋，那就太複雜了

## 開發流程

### 1. 規劃與分階段

將複雜工作拆分為 3-5 個階段。記錄在 `IMPLEMENTATION_PLAN.md`：

```markdown
## 階段 N: [名稱]
**目標**: [具體交付成果]
**成功標準**: [可測試的結果]
**測試**: [具體測試案例]
**狀態**: [未開始|進行中|已完成]
```
- 隨時更新狀態
- 所有階段完成後刪除檔案

### 2. 實作流程

1. **理解** - 研究程式碼庫中的現有模式
2. **測試** - 先寫測試（紅燈）
3. **實作** - 最少程式碼通過測試（綠燈）
4. **重構** - 在測試通過的情況下清理程式碼
5. **提交** - 附上清楚的訊息連結到計劃

### 3. 遇到困難時（3 次嘗試後）

**關鍵**: 每個問題最多嘗試 3 次，然後停止。

1. **記錄失敗內容**:
   - 你嘗試了什麼
   - 具體錯誤訊息
   - 你認為為何失敗

2. **研究替代方案**:
   - 找出 2-3 個類似實作
   - 記錄使用的不同方法

3. **質疑基本假設**:
   - 這是正確的抽象層級嗎？
   - 能否拆分成更小的問題？
   - 是否有更簡單的方法？

4. **嘗試不同角度**:
   - 不同的函式庫/框架功能？
   - 不同的架構模式？
   - 移除抽象而非增加？

## 技術標準

### 架構原則

- **組合優於繼承** - 使用依賴注入
- **介面優於單例** - 啟用測試與彈性
- **明確優於隱含** - 清晰的資料流與依賴關係
- **盡可能測試驅動** - 永不停用測試，而是修正它們

### 程式碼品質

- **每次提交必須**:
  - 編譯成功
  - 通過所有現有測試
  - 包含新功能的測試
  - 遵循專案格式化/檢查規範

- **提交前**:
  - 執行格式化工具/檢查工具
  - 自我審查變更
  - 確保提交訊息解釋「為什麼」

### 錯誤處理

- 快速失敗並附上描述性訊息
- 包含除錯的上下文資訊
- 在適當層級處理錯誤
- 永不默默吞下例外

## 決策框架

當有多個有效方法時，依據以下選擇：

1. **可測試性** - 我能輕易測試這個嗎？
2. **可讀性** - 6 個月後有人能理解嗎？
3. **一致性** - 這符合專案模式嗎？
4. **簡單性** - 這是最簡單可行的解決方案嗎？
5. **可逆性** - 之後改變有多困難？

## 專案整合

### 學習程式碼庫

- 找出 3 個類似的功能/元件
- 識別共同的模式與慣例
- 盡可能使用相同的函式庫/工具
- 遵循現有的測試模式

### 工具

- 使用專案現有的建置系統
- 使用專案的測試框架
- 使用專案的格式化/檢查工具設定
- 沒有充分理由不引入新工具

## 品質關卡

### 完成定義

- [ ] 測試已撰寫並通過
- [ ] 程式碼遵循專案慣例
- [ ] 無檢查/格式化警告
- [ ] 提交訊息清楚明確
- [ ] 實作符合計劃
- [ ] 沒有缺少議題編號的 TODO

### 測試指南

- 測試行為，而非實作
- 盡可能每個測試一個斷言
- 清楚描述情境的測試名稱
- 使用現有的測試工具/輔助函式
- 測試應具確定性

## 重要提醒

**絕不**:
- 使用 `--no-verify` 繞過提交鉤子
- 停用測試而非修正它們
- 提交無法編譯的程式碼
- 做假設 - 用現有程式碼驗證

**永遠**:
- 漸進式提交可運作的程式碼
- 隨時更新計劃文件
- 從現有實作中學習
- 3 次失敗嘗試後停止並重新評估

## 工具

- 你可以使用 `gemini -p "xxx"` 來呼叫 gemini cli 這個工具做事情，gemini cli 的上下文 token 很大，你可以用它找專案裡的程式碼，上網查資料等。但**禁止使用它修改或刪除檔案**。

**使用範例**:
```bash
gemini -p "找出專案裡使用 xAI 的地方"
```

## Shell 工具使用指南

⚠️ **重要**: 使用以下專用工具而非傳統 Unix 指令：（如缺少請安裝）

| 任務類型 | 必須使用 | 不要使用 |
|---------|---------|---------|
| 尋找檔案 | `fd` | `find`, `ls -R` |
| 搜尋文字 | `rg` (ripgrep) | `grep`, `ag` |
| 分析程式碼結構 | `ast-grep` | `grep`, `sed` |
| 互動式選擇 | `fzf` | 手動篩選 |
| 處理 JSON | `jq` | `python -m json.tool` |
| 處理 YAML/XML | `yq` | 手動解析 |
